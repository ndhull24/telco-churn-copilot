<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>T3C â€“ Dashboard</title>
  <link rel="stylesheet" href="/static/style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header class="topbar">
  <h1>ðŸ“ˆ T3C â€” Executive Dashboard</h1>
  <a class="pill" href="/">â¬… Back to App</a>
  <a class="pill" href="/docs" target="_blank">API Docs</a>
</header>

<section class="table-wrap">
  <h2>Summary</h2>
  <ul>
    <li>Total logged actions: <b>{{stats.logged}}</b></li>
    <li>Compliance pass rate: <b>{{stats.pass_rate}}%</b></li>
    <li>Violations: <b>{{stats.violations}}</b></li>
  </ul>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start;">
    <div>
      <h3>Compliance Pass Rate (daily)</h3>
      <canvas id="trendChart" height="220"></canvas>
    </div>
    <div>
      <h3>Approved Actions (count)</h3>
      <canvas id="actionChart" height="220"></canvas>
    </div>
  </div>
</section>

<script>
const trend = {{ trend|tojson }};
const byAction = {{ by_action|tojson }};

if (trend.length){
  const ctx = document.getElementById('trendChart');
  new Chart(ctx,{
    type:'line',
    data:{
      labels: trend.map(r=>r.date),
      datasets:[{
        label:'Pass Rate (%)',
        data: trend.map(r=>r.pass_rate),
        borderColor:'#6ea8fe',
        fill:false,
        tension:0.25
      }]
    },
    options:{responsive:true, scales:{y:{min:0,max:100}}}
  });
}

if (byAction.length){
  const ctx2 = document.getElementById('actionChart');
  new Chart(ctx2,{
    type:'bar',
    data:{
      labels: byAction.map(r=>r.action),
      datasets:[{label:'Count', data: byAction.map(r=>r.count)}]
    },
    options:{responsive:true, plugins:{legend:{display:false}}}
  });
}
</script>
</body>
</html>
